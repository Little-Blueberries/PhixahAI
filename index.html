<!DOCTYPE html>
<!--
                    Contest: AI
                
         I have completed 100% of Khan Academy's 
        'Intro to HTML/CSS' and have been programming 
                    for 17 months.
    
          I would prefer to be placed in the
                    [Intermediate]
                       bracket
                       
        In creating this entry, I focused on make an AI chatbot that can answer every user's questions about Python programming.
                                
  One aspect I found challenging was to make the chatbot can understand the user question in case right syntax or wrong syntax, also the .md format for the chatbot content.
                                
                   I would like to highlight
        This chatbot use a TF-IDF and Consine Similarity to
        understand the user question if it is not at true
        grammer or it's at the same meaning but different way 
        to express, so it's use for the check the best match.
        In this challenge, I learned about how to use make
        user can copy everything in a big code blocks without
        externals API, Markdown syntax for the chatbot, and 
        advanced styling.
                        for the judges.
                       
    
    TODO:
     - Fill out statements above (Done)
     - Save your entry as a spin-off of this program (Done)
     - Have fun! (Not yet :))
-->
<!--
    This chatbot still don't have enough, I only add one data for it to answer only one question: What is Python?
    Sorry for inconvenience, i will add more data, and allow user to train it also in a user-friendly way, not to change the code!.
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PhixahAI (demo)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap" rel="stylesheet">
    <style>
        * {
            transition: all 0.5s ease;
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 20px;
            background-color: #1b1b1b;
            font-family: 'Montserrat', sans-serif;
            color: white;
        }
        body::-webkit-scrollbar {
            display: none;
        }
        
        #chat-container {
            height: 390px;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border: 1px solid #333;
            border-radius: 8px;
            background-color: #121212;
        }
        #chat-container::-webkit-scrollbar {
            display: none;
        }
        
        .user-message, .bot-message {
            padding: 10px 20px;
            border-radius: 10px;
            word-wrap: break-word;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            font-family: 'Segoe UI', Ubuntu, sans-serif;
        }
        
        .user-message {
            align-self: flex-end;
            background-color: #292929;
            text-align: right;
            max-width: 70%;
        }
        
        .bot-message {
            align-self: flex-start;
            text-align: left;
            line-height: 1.5em;
        }
        
        .input-group {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 0.5em;
            background-color: #292929;
        }
        
        #user-input {
            padding: 0.75em 1em;
            border: none;
            border-radius: 0.25em;
            font-family: 'Montserrat', sans-serif;
            font-size: 1em;
            background-color: #292929;
            color: white;
            resize: none;
            height: 2em;
            width: 100%;
            line-height: 1.4em;
            overflow: auto;
        }
        
        #user-input::placeholder {
            color: rgb(160, 160, 160);
        }
        
        #user-input:focus {
            outline: none;
        }
        
        #user-input::-webkit-scrollbar {
            display: none;
        }
        
        .function {
            display: flex;
            justify-content: flex-end;
            padding: 0.5em;
        }
        
        #clear-button {
            font-size: 1.25em;
            background-color: #292929;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 0.25em;
            cursor: pointer;
            width: 2.2em;
            height: 2.2em;
            overflow: hidden;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: width 0.4s ease, background-color 0.3s ease;
        }
        
        #clear-button span {
            display: inline-block;
            max-width: 0;
            overflow: hidden;
            white-space: nowrap;
            transition: max-width 0.4s ease, margin-left 0.4s ease;
            margin-left: 0;
        }
        
        #clear-button:hover {
            width: 110px;
            background-color: #3b3b3b;
        }
        
        #clear-button:hover span {
            max-width: 100px;
            margin-left: 8px;
        }
        
        #chatbot-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 300;
            font-size: 2.5em;
            color: white;
            text-align: center;
            margin: 0 0 10px;
        }
        
        .code-blocks {
            background-color: rgba(196, 196, 196, 0.342);
            border-radius: 4px;
            padding: 1px 8px;
            font-family: 'Courier New', Courier, monospace;
        }
        
        .big-code-blocks {
            background-color: #000000;
            padding: 10px;
            border-radius: 0 0 5px 5px;
            font-family: 'Courier New', Courier, monospace;
            font-weight: 700;
            white-space: pre-wrap;
        }
        
        pre {
            display: flex;
            flex-direction: column;
        }

        pre div {
            display: flex;
            flex-direction: row;
            background-color: #292929;
            border-radius: 5px 5px 0 0;
            height: 25px;
            justify-content: flex-end;
            align-items: center;
            padding-right: 10px;
        }
        
        pre div button {
            background-color: #292929;
            color: white;
            font-family: 'Segoe UI', Ubuntu, Tahoma, Geneva, Verdana, sans-serif;
            border: none;
            outline: none;
        }

        li {
            line-height: 1.25em;
            margin-left: 0.5em;
            margin-bottom: -0.5em;
        }

        ul, ol {
            margin-top: 0;
        }

        code {
            font-family: 'Fira Code', 'Courier New', Courier, monospace;
        }

        p {
            margin-top: 0;
            margin-bottom: 0;
        }

        .dot-typing {
            display: inline-block;
            position: relative;
            width: 24px;
            height: 8px;
        }

        .dot-typing div {
            position: absolute;
            width: 5px;
            height: 5px;
            background-color: #ccc;
            border-radius: 50%;
            animation: dotTypingAnim 1s infinite ease-in-out;
        }

        .dot-typing div:nth-child(1) {
            left: 0;
            animation-delay: 0s;
        }
        .dot-typing div:nth-child(2) {
            left: 8px;
            animation-delay: 0.2s;
        }
        .dot-typing div:nth-child(3) {
            left: 16px;
            animation-delay: 0.4s;
        }

        @keyframes dotTypingAnim {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1.2);
                opacity: 1;
            }
        }
        
    </style>
</head>
<body>
    <h1 id="chatbot-title">PHIXAH</h1>
    <div id="chat-container"></div>
    <div class="input-group">
        <textarea type="text" id="user-input" placeholder="Enter your question..."></textarea>
        <div class="function">
            <button id="clear-button" style="vertical-align: middle;">×<span>Clear</span></button>
        </div>
    </div>
    
    <script>
        // Get HTML Elements
        var copyButton = document.getElementsByClassName("copy-button")
        var chatContainer = document.getElementById("chat-container");
        var userInput = document.getElementById("user-input");
        var clearButton = document.getElementById("clear-button");

        // Format the answer from the chatbot
        function format(text) {
            text = text.replace(/<br>/g, '\n');
            
            text = text.replace(/^###\s+(.*$)/gm, '<h4 style="margin-bottom: -0.8em;">$1</h4>');
            text = text.replace(/^##\s+(.*$)/gm, '<h3 style="margin-bottom: -0.75em;">$1</h3>');
            text = text.replace(/^#\s+(.*$)/gm, '<h2 style="margin-bottom: -0.65em;">$1</h2>');
            
            // Process bold/italic
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/\_\_(.*?)\_\_/g, '<strong>$1</strong>');
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
            text = text.replace(/\_(.*?)\_/g, '<em>$1</em>');
            
            text = text.replace(/\$\$(.*?)\$\$/g, function(match, p1) {
                p1 = p1.replace(/\`(.*?)\`/g, '<p>$1</p>')
                return '<pre><div><button class="copy-button">Copy</button></div><code class="big-code-blocks">' + p1 + '</code></pre>';
            });
            text = text.replace(/\$(.*?)\$/g, '<code class="code-blocks">$1</code>')
            
            text = text.replace(/\n/g, '<br>');
            
            return text;
        }

        // The chatbot system object
        function manageChatbotSystem() {
            this.documents = [];
            this.responses = [];
            this.wordIDF = {};
        }
        manageChatbotSystem.prototype.addData = function(question, response) {
            this.documents.push(question);
            this.responses.push(decodeURIComponent(escape(atob(response))));
        };
        manageChatbotSystem.prototype.calculateTF = function(word, document) {
            var words = document.split(/\s+/);
            var count = 0;
            for (var i = 0; i < words.length; i++) {
                if (words[i] === word) count++;
            }
            return count / words.length;
        };
        manageChatbotSystem.prototype.calculateIDF = function(word) {
            if (this.wordIDF[word] !== undefined) return this.wordIDF[word];
            var count = 0;
            for (var i = 0; i < this.documents.length; i++) {
                if (this.documents[i].split(/\s+/).indexOf(word) !== -1) count++;
            }
            var idf = Math.log(this.documents.length / (1 + count)) + 1;
            this.wordIDF[word] = idf;
            return idf;
        };
        manageChatbotSystem.prototype.computeVector = function(doc) {
            var words = doc.split(/\s+/);
            var tfidf = {};
            for (var i = 0; i < words.length; i++) {
                var word = words[i];
                if (!tfidf[word]) {
                    tfidf[word] = this.calculateTF(word, doc) * this.calculateIDF(word);
                }
            }
            return tfidf;
        };
        manageChatbotSystem.prototype.cosineSimilarity = function(v1, v2) {
            var sum = 0, mag1 = 0, mag2 = 0;
            var keys = {};
            for (var key in v1) keys[key] = true;
            for (var key in v2) keys[key] = true;
            for (var key in keys) {
                var a = v1[key] || 0;
                var b = v2[key] || 0;
                sum += a * b;
                mag1 += a * a;
                mag2 += b * b;
            }
            if (mag1 === 0 || mag2 === 0) return 0;
            return sum / (Math.sqrt(mag1) * Math.sqrt(mag2));
        };
        manageChatbotSystem.prototype.findAnswer = function(userInput) {
            var inputVector = this.computeVector(userInput);
            var maxScore = 0;
            var answer = "Sorry, I don't understand."
            for (var i = 0; i < this.documents.length; i++) {
                var docVector = this.computeVector(this.documents[i]);
                var score = this.cosineSimilarity(inputVector, docVector);
                if (score > maxScore) {
                    maxScore = score;
                    answer = this.responses[i];
                }
            }
            return answer;
        }
        
        
        var chatbot = new manageChatbotSystem();
        var dataTesting = {
            "What is Python?": 'IyDinIUgV2hhdCBpcyBQeXRob24/IDxicj4jIyDinpUgSW50cm9kdWNlIGFib3V0IFB5dGhvbjxicj5QeXRob24gaXMgYSAqKmhpZ2gtbGV2ZWwsIGdlbmVyYWwtcHVycG9zZSBwcm9ncmFtbWluZyBsYW5ndWFnZS4qKjxicj5JdCBpcyBkZXNpZ25lZCB0byBiZSAqKmVhc3kgdG8gcmVhZCoqLCAqKnNpbXBsZSB0byB3cml0ZSoqLCBhbmQgKip2ZXJ5IHBvd2VyZnVsKiouPGJyPlBlb3BsZSB1c2UgUHl0aG9uIHRvIGNyZWF0ZTo8YnI+JmVtc3A7LSBHYW1lcyDwn46uPGJyPiZlbXNwOy0gV2Vic2l0ZXMg8J+MkDxicj4mZW1zcDstIEFydGlmaWNpYWwgSW50ZWxsaWdlbmNlIPCfp6A8YnI+JmVtc3A7LSBEYXRhIGFuYWx5c2lzIHRvb2xzIPCfk4o8YnI+JmVtc3A7LSBBbmQgZXZlbiByb2JvdHMg8J+kliMjIOKelSBQeXRob24gaGlzdG9yeTxicj4mZW1zcDstIFB5dGhvbiB3YXMgY3JlYXRlZCBieSAqKkd1aWRvIHZhbiBSb3NzdW0qKiBpbiB0aGUgKipsYXRlIDE5ODBzKiogYW5kIG9mZmljaWFsbHkgcmVsZWFzZWQgaW4gKioxOTkxKiouPGJyPiZlbXNwOy0gVGhlIG5hbWUgKioiUHl0aG9uIioqIGlzIGluc3BpcmVkIGJ5IHRoZSBCcml0aXNoIGNvbWVkeSBncm91cCAqKk1vbnR5IFB5dGhvbioqLCBub3QgdGhlIHNuYWtlLjxicj4mZW1zcDstIE92ZXIgdGhlIHllYXJzLCBQeXRob24gaGFzIGV2b2x2ZWQ6PGJyPiZlbXNwOyZlbXNwOy0gKipQeXRob24gMi54Kiog4oCTIG9sZGVyIHZlcnNpb24gKG5vdyBvdXRkYXRlZCk8YnI+JmVtc3A7JmVtc3A7LSAqKlB5dGhvbiAzLngqKiDigJMgY3VycmVudCBhbmQgbW9kZXJuIHZlcnNpb24sIHJlY29tbWVuZGVkIGZvciBldmVyeW9uZSA8YnI+IyMg4p6VIFdoYXQgaXQgZG9lcz88YnI+UHl0aG9uIGlzIHVzZWQgaW4gKiptYW55IGZpZWxkcyoqLCBpbmNsdWRpbmc6PGJyPiZlbXNwOy0gKipBSSAmIE1hY2hpbmUgTGVhcm5pbmcqKjogYnVpbGQgc21hcnQgc3lzdGVtcyB0aGF0IGNhbiBsZWFybiBhbmQgcHJlZGljdDxicj4mZW1zcDstICoqV2ViIERldmVsb3BtZW50Kio6IGJ1aWxkIHBvd2VyZnVsIHdlYnNpdGVzIGFuZCBhcHBzPGJyPiZlbXNwOy0gKipBdXRvbWF0aW9uKio6IHdyaXRlIHNjcmlwdHMgdG8gZG8gYm9yaW5nIHdvcmsgYXV0b21hdGljYWxseTxicj4mZW1zcDstICoqR2FtZSBEZXZlbG9wbWVudCoqOiBjcmVhdGUgZ2FtZXMgdXNpbmcgMkQgb3IgZXZlbiAzRCBsaWJyYXJpZXM8YnI+JmVtc3A7LSAqKkRhdGEgU2NpZW5jZSoqOiBhbmFseXplLCB2aXN1YWxpemUsIGFuZCB1bmRlcnN0YW5kIGRhdGEgPGJyPiMg8J+UjSBHbyBkZWVwZXIgYWJvdXQgcGVyZm9ybWFuY2Ugb2YgUHl0aG9uPGJyPlB5dGhvbiBpcyBub3QgdGhlICoqZmFzdGVzdCoqIHByb2dyYW1taW5nIGxhbmd1YWdlLCBidXQgaXTigJlzICoqZmFzdCBlbm91Z2gqKiBmb3IgbW9zdCB0YXNrcy4gPGJyPiMjIOKelSBBZHZhbnRhZ2VzPGJyPiZlbXNwOy0gKirinIUgRmFzdCB0byB3cml0ZSoqIOKAkyBDb2RlIGlzIHNob3J0ZXIgYW5kIGVhc2llciB0aGFuIEMrKyBvciBKYXZhPGJyPiZlbXNwOy0gKirinIUgUXVpY2sgZGV2ZWxvcG1lbnQqKiDigJMgR29vZCBmb3IgcmFwaWQgcHJvdG90eXBpbmcgYW5kIHRlc3RpbmcgaWRlYXM8YnI+JmVtc3A7LSAqKuKchSBCaWcgZWNvc3lzdGVtKiog4oCTIFRob3VzYW5kcyBvZiBsaWJyYXJpZXMgbGlrZSBOdW1QeSwgVGVuc29yRmxvdywgRmxhc2suLi4gPGJyPiMjIOKeliBEaXNhZHZhbnRhZ2VzPGJyPiZlbXNwOy0gKirinYwgU2xvd2VyIGV4ZWN1dGlvbiBzcGVlZCoqIHRoYW4gQysrLCBSdXN0LCBvciBKYXZhPGJyPiZlbXNwOy0gKirinYwgTm90IGlkZWFsIGZvciBoZWF2eSByZWFsLXRpbWUgc3lzdGVtcyoqIChsaWtlIEFBQSAzRCBnYW1lcyBvciBPUyBrZXJuZWxzKTxicj4mZW1zcDstICoq4p2MIFNpbmdsZS10aHJlYWRlZCBieSBkZWZhdWx0Kiog4oCTIE5vdCB0aGUgYmVzdCBmb3IgcGFyYWxsZWwgcGVyZm9ybWFuY2UgPGJyPiMjIOKame+4jyBXaHkgcGVvcGxlIHN0aWxsIHVzZSBQeXRob24gZGVzcGl0ZSBzbG93ZXIgc3BlZWQ/PGJyPkJlY2F1c2UgbW9zdCBvZiB0aGUgdGltZSwgKipkZXZlbG9wZXIgdGltZSoqIGlzIG1vcmUgaW1wb3J0YW50IHRoYW4gKiptYWNoaW5lIHRpbWUqKi48YnI+UHl0aG9uIGlzICoqZmFzdCB0byBidWlsZCoqLCAqKmVhc3kgdG8gdGVzdCoqLCBhbmQgaGFzICoqdG9ucyBvZiB0b29scyoqIHRvIHNwZWVkIHVwIGRldmVsb3BtZW50Ljxicj5QbHVzLCBwZXJmb3JtYW5jZSBjYW4gYmUgaW1wcm92ZWQgYnk6PGJyPiZlbXNwOyAtIFVzaW5nIGxpYnI7YXJpZXMgd3JpdHRlbiBpbiBDL0MrKyAobGlrZSBOdW1QeSk8YnI+JmVtc3A7IC0gQ29tYmluaW5nIHdpdGggb3RoZXIgbGFuZ3VhZ2VzIChlLmcuLCB1c2UgUHl0aG9uICsgQysrKTxicj4mZW1zcDsgLSBSdW5uaW5nIG9uIGZhc3RlciBtYWNoaW5lcyAoQ2xvdWQsIEdQVS4uLikgPGJyPiMg8J+SoSBTb21lIGV4YW1wbGVzIDxicj4jIyDwn5OYIEV4YW1wbGUgMTogSGVsbG8gV29ybGQ8YnI+JCRwcmludCgiSGVsbG8sIHdvcmxkISIpJCQgPGJyPiMjIPCfk5ggRXhhbXBsZSAyOiBTaW1wbGUgQ2FsY3VsYXRvcjxicj4kJGBhID0gaW50KGlucHV0KCJFbnRlciBmaXJzdCBudW1iZXI6ICIpKWBgYiA9IGludChpbnB1dCgiRW50ZXIgc2Vjb25kIG51bWJlcjogIikpYGBwcmludCgiU3VtIGlzOiIsIGEgKyBiKWAkJCA8YnI+IyMg8J+TmCBFeGFtcGxlIDM6IElmLWVsc2UgbG9naWM8YnI+JCRgYWdlID0gaW50KGlucHV0KCJZb3VyIGFnZT8gIikpYGBpZiBhZ2UgPj0gMTg6YGAmZW1zcDtwcmludCgiWW91IGFyZSBhbiBhZHVsdC4iKWBgZWxzZTpgYCZlbXNwO3ByaW50KCJZb3UgYXJlIHN0aWxsIHlvdW5nISIpYCQkPGJyPiMjIPCfk5ggRXhhbXBsZSA0OiBMb29wPGJyPiQkYGZvciBpIGluIHJhbmdlKDUpOmBgJmVtc3A7cHJpbnRmKCJTdGVwIHtpfSIpYCQkIDxicj4jIPCfjq8gQ29uY2x1c2lvbjxicj4mZW1zcDstIOKchSBQeXRob24gaXMgYSBwb3dlcmZ1bCwgZWFzeS10by1sZWFybiBsYW5ndWFnZSB1c2VkIGluIG1hbnkgaW5kdXN0cmllcy48YnI+JmVtc3A7LSDinIUgSXTigJlzIHBlcmZlY3QgZm9yICoqc3R1ZGVudHMqKiwgKipkZXZlbG9wZXJzKiosIGFuZCBldmVuICoqc2NpZW50aXN0cyoqLjxicj4mZW1zcDstIOKchSBUaG91Z2ggaXTigJlzIG5vdCB0aGUgZmFzdGVzdCBpbiB0ZXJtcyBvZiBwZXJmb3JtYW5jZSwgaXRzICoqc2ltcGxpY2l0eSwgdG9vbHMsIGFuZCBmbGV4aWJpbGl0eSoqIG1ha2UgaXQgYSB0b3AgY2hvaWNlLjxicj4mZW1zcDstIPCfkqEgSWYgeW91IHdhbnQgdG8gKipidWlsZCBhcHBzKiosICoqbGVhcm4gQUkqKiwgb3IgKiphdXRvbWF0ZSB0YXNrcyoqLCBQeXRob24gaXMgb25lIG9mIHRoZSBiZXN0IHRvb2xzIHlvdSBjYW4gc3RhcnQgd2l0aC4='
        }

        for (var question in dataTesting) {
            chatbot.addData(question, dataTesting[question]);
        }
        
        function showLoading() {
            document.getElementById("loading-message").style.display = "block";
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        function hideLoading() {
            document.getElementById("loading-message").style.display = "none";
        }

        function addMessage(message, isUser) {
            var msg = document.createElement("div");
            msg.className = isUser ? "user-message" : "bot-message";
            msg.innerHTML = isUser? message : format(message);
            chatContainer.appendChild(msg);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        function handleUserMessage() {
            var message = userInput.value.trim();
            if (message) {
                addMessage(message, true);

                // Thêm block loading
                const loadingMsg = document.createElement("div");
                loadingMsg.className = "bot-message loading";
                loadingMsg.innerHTML = '<div class="dot-typing"><div></div><div></div><div></div></div>';
                chatContainer.appendChild(loadingMsg);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                userInput.value = "";

                setTimeout(function() {
                    var response = chatbot.findAnswer(message);

                    chatContainer.removeChild(loadingMsg);

                    addMessage(response, false);
                }, 2000);
            }
        }
         
        function handleClearMessage() {
            chatContainer.innerHTML = '';
            alert("Chat history cleared successfully");
        }
        
        // Copy button function
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('copy-button')) {
            var preElement = e.target.closest('pre');
            if (!preElement) return;

            var codeBlock = preElement.querySelector('code');
            if (!codeBlock) return;

            var range = document.createRange();
            range.selectNodeContents(codeBlock);
            var selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);

            try {
                var success = document.execCommand('copy');
                if (success) {
                    e.target.textContent = "Copied!";
                    setTimeout(function() {e.target.textContent="Copy"}, 1000);
                } else {
                    e.target.textContent = "Failed";
                }
            } catch (err) {
                console.error("Copy failed:", err);
            }

            selection.removeAllRanges();
        }

        });

        clearButton.addEventListener("click", handleClearMessage);
        userInput.addEventListener("keydown", function(e) {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                handleUserMessage();
            }
        });
    </script>
</body>
</html>