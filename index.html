<!DOCTYPE html>
<!--
					Contest: AI
				
		 I have completed 100% of Khan Academy's 
		'Intro to HTML/CSS' and have been programming 
					for 25 months.
	
		  I would prefer to be placed in the
					Intermediate
					   bracket
					   
		In creating this entry, I focused on make an AI chatbot that can chat with the user.
								
  One aspect I found challenging was to make the chatbot can understand the user question in case right syntax or wrong syntax.
								
				   I would like to highlight
		This chatbot use a TF-IDF and Consine Similarity to
		understand the user question if it is not at true
		grammar or it's at the same meaning but different way 
		to express, so it's use for the check the best match.
						for the judges.
					   
	TODO:
	 - Fill out statements above (Done)
	 - Save your entry as a spin-off of this program (Done)
	 - Have fun! (Done)
-->
<!--
    Credit @awesomeorion for the ka img and the thumbnail script
    Credit iconsvg.xyz for the SVG icon
-->
<!--
    ! WARNING: Don't change any line from this code, even a character, or else the Javascript in this program won't work.
    * If you accidentally do that, the only solution is to restart all the khan academy page.
    ? Why reload the Khan Academy Sandbox is not work: Reload will not work in this case, because some function depend on Khan Academy website instead of Khan Academy sandbox.
-->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>PhixahAI (Testing)</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=error" />
    <style>
        :root {
            --dark-bg: #1b1b1b;
            --dark-bg-alt: #121212;
            --dark-text: #fff;
            --dark-border: #333;
            --dark-user-msg-bg: #292929;
            --dark-bot-msg-bg: #292929;
            --dark-input-bg: #292929;
            --dark-access-bg: #292929;
            --dark-access-hover: #414141;
            --dark-dot: #888;
            --dark-title: #fff;
            --dark-placeholder: #888;
            --light-bg: #f4f4f4;
            --light-bg-alt: #e9e9ee;
            --light-text: #222;
            --light-border: #ccc;
            --light-user-msg-bg: #e0e0e0;
            --light-bot-msg-bg: #e0e0e0;
            --light-input-bg: #e6e6e6;
            --light-access-bg: #e0e0e0;
            --light-access-hover: #8d8d8d;
            --light-dot: #888;
            --light-title: #222;
            --light-placeholder: #888;
        }

        * {
            box-sizing: border-box;
            transition: all 0.5s;
        }

        body::-webkit-scrollbar,
        #chat-container::-webkit-scrollbar,
        #user-input::-webkit-scrollbar {
            display: none;
        }

        #chat-container,
        .input-group,
        .function,
        .accessibility,
        .chat-container,
        .title-bar,
        .block,
        .popup,
        .popup .popup-btn-row {
            display: flex;
        }

        body,
        html {
            max-width: 100vw;
            overflow-x: hidden;
        }

        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--dark-bg);
            color: var(--dark-text);
        }

        body.light-theme {
            background: var(--light-bg);
            color: var(--light-text);
        }

        #chatbot-title {
            animation: titleMov 3s ease-in-out infinite;
            font-size: 3em;
            font-weight: 700;
            margin: 0 0 10px;
            text-align: center;
        }

        #chat-container {
            flex: 1 1 auto;
            border-radius: 8px;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            padding: 10px;
            justify-content: center;
            background: var(--dark-bg-alt);
            border: 1px solid var(--dark-border);
        }

        body.light-theme #chat-container {
            background: var(--light-bg-alt);
            border: 1px solid var(--light-border);
        }

        #chat-container-title {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1.5em;
            text-align: center;
        }

        .input-group,
        .function,
        .accessibility,
        .chat-container,
        .title-bar,
        .block,
        .popup,
        .popup .popup-btn-row {
            display: flex;
        }

        .input-group {
            gap: 0.5em;
            margin-top: 10px;
            background: none;
        }

        #user-input {
            border: none;
            border-radius: 0.25em;
            font-size: 1em;
            height: 0;
            line-height: 1.4em;
            overflow: auto;
            padding: 1.25em 1em;
            resize: none;
            width: 100%;
            font-family: inherit;
            background: var(--dark-input-bg);
            color: var(--dark-text);
        }

        body.light-theme #user-input {
            background: var(--light-input-bg);
            color: var(--light-text);
        }

        #user-input:focus {
            outline: none;
        }

        .input-group:has(#user-input:focus) {
            box-shadow: 0 0 5px 0.001px #919191;
        }

        #user-input::placeholder {
            color: var(--dark-placeholder);
        }

        body.light-theme #user-input::placeholder {
            color: var(--light-placeholder);
        }

        .function {
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5em;
        }

        .accessibility {
            align-items: center;
            justify-content: center;
            padding: 0.4em;
            background: var(--dark-access-bg);
        }

        body.light-theme .accessibility {
            background: var(--light-access-bg);
        }

        .accessibility:hover {
            background: var(--dark-access-hover);
        }

        body.light-theme .accessibility:hover {
            background: var(--light-access-hover);
            color: var(--light-text);
        }

        .user-message,
        .bot-message {
            border-radius: 10px;
            max-width: 70%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-wrap: anywhere;
            word-break: break-all;
            white-space: pre-wrap;
            word-wrap: break-word;
            animation: fadeIn 1s;
        }

        .user-message {
            align-self: flex-end;
            opacity: 1;
            transform: translateY(0%);
        }

        .bot-message {
            align-self: flex-start;
            line-height: 1.5em;
            text-align: left;
        }

        .user-message .message,
        .bot-message .message {
            padding: 10px 20px;
            background: var(--dark-user-msg-bg);
            color: var(--dark-text);
        }

        body.light-theme .user-message .message,
        body.light-theme .bot-message .message {
            background: var(--light-user-msg-bg);
            color: var(--light-text);
        }

        .user-message img,
        .bot-message img {
            border-radius: 50%;
            margin: 0 10px;
            width: 2em;
            height: 2em;
            display: flex;
            justify-content: center;
        }

        .dot-typing {
            display: inline-block;
            height: 8px;
            position: relative;
            width: 24px;
        }

        .dot-typing div {
            animation: dotTypingAnim 1s infinite ease-in-out;
            border-radius: 50%;
            height: 5px;
            position: absolute;
            width: 5px;
            background: var(--dark-dot);
        }

        .dot-typing div:nth-child(1) {
            animation-delay: 0s;
            left: 0;
        }

        .dot-typing div:nth-child(2) {
            animation-delay: 0.2s;
            left: 8px;
        }

        .dot-typing div:nth-child(3) {
            animation-delay: 0.4s;
            left: 16px;
        }

        body.light-theme .dot-typing div {
            background: var(--light-dot);
        }

        #accessibility-screen {
            display: flex;
            position: absolute;
            background-color: #000a;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            top: 0;
            left: 0;
            justify-content: center;
            align-items: center;
            display: none;
        }

        #deleteChat:not(.button-row *) {
            width: fit-content;
            height: fit-content;
            padding: 4vh 3vw;
            border-radius: 1vmin;

            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;

            margin: 3em;
            text-align: center;
        }

        #deleteChat *:not(.button-row *) {
            margin: 1em;
        }

        #deleteChat .description {
            margin-top: 3em;
            margin-bottom: -1em;
        }

        #deleteChat .button-row {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
            height: 20%;
            margin-bottom: 0;
        }

        #deleteChat .button-row .button,
        #dataManager .btn-submit {
            flex: 1 0 50%;
            min-width: 0;
            padding: 2.5% 5%;
            margin: 1%;
            cursor: pointer;
        }

        #deleteChat .icon {
            transform: scale(5);
        }

        #addData,
        #removeData,
        #clearAllData {
            flex-direction: column;
            box-shadow: 0px 0px 10px 1px gray;
            padding: 1em;
        }

        #addData {
            width: 20em;
        }

        #dataManager {
            width: fit-content;
            height: fit-content;
            padding: 4vh 15vw;
            border-radius: 1vmin;

            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;

            margin: 3em;
            text-align: center;
        }

        #dataManager h2 {
            margin-bottom: 0;
        }

        #dataManager input {
            font-family: inherit;
            border: none;
            outline: none;
            width: 100%;
            height: 25%;
            padding: 5px;
            background-color: var(--dark-placeholder);
        }

        body.light-theme #dataManager input {
            background-color: var(--light-placeholder);
        }

        #dataManager label {
            display: flex;
            justify-content: space-between;
            flex-direction: column;
            align-items: flex-start;
            margin: 1em;
        }

        #rangeSliderData {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;

            cursor: pointer;
            width: 15rem;
            padding: 0.5em 1em;
        }

        #rangeSliderData::-webkit-slider-runnable-track {
            height: 0.5em;
            background-color: var(--dark-placeholder);
        }

        body.light-theme #rangeSliderData::-webkit-slider-runnable-track {
            background-color: var(--light-placeholder);
        }

        #rangeSliderData::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            margin-top: -4px;

            height: 0.9rem;
            width: 0.45rem;
            background-color: #575757;
        }

        #dataManager, #deleteChat {
            background: var(--dark-bg-alt);
        }
        body.light-theme #dataManager, body.light-theme #deleteChat {
            background: var(--light-bg-alt);
        }


        @keyframes dotTypingAnim {

            0%,
            80%,
            100% {
                opacity: 0.5;
                transform: scale(0.8);
            }

            40% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        @keyframes titleMov {

            0%,
            100% {
                transform: translateY(0%);
            }

            50% {
                transform: translateY(-8%);
            }
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translateY(100%);
            }

            100% {
                opacity: 1;
                transform: translateY(0%);
            }
        }

        @keyframes popupBgFadeOut {
            0% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        @keyframes popupBgFadeIn {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes popupFadeOut {
            0% {
                opacity: 1;
                transform: translateY(0%);
            }

            100% {
                opacity: 0;
                transform: translateY(-100%);
            }
        }

        @keyframes popupFadeIn {
            0% {
                opacity: 0;
                transform: translateY(-100%);
            }

            100% {
                opacity: 1;
                transform: translateY(0%);
            }
        }

        /* Button styles */
        .button,
        .btn-confirm,
        .btn-exit,
        .btn-submit {
            background: var(--dark-access-bg);
            color: var(--dark-text);
            border-radius: 6px;
            padding: 0.5em 1.2em;
            cursor: pointer;
            border: none;
            transition: background 0.2s, box-shadow 0.2s, transform 0.15s;
            font-family: inherit;
            font-size: 1em;
            margin: 0.2em;
            box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.08);
        }

        .button:hover,
        .btn-confirm:hover,
        .btn-exit:hover,
        .btn-submit:hover {
            background: var(--dark-access-hover);
            color: #fff;
            box-shadow: 0 4px 16px 0 rgba(0, 0, 0, 0.16);
            transform: translateY(-2px) scale(1.04);
        }

        .button:active,
        .btn-confirm:active,
        .btn-exit:active,
        .btn-submit:active {
            background: #222;
            transform: scale(0.98);
        }

        body.light-theme .button,
        body.light-theme .btn-confirm,
        body.light-theme .btn-exit,
        body.light-theme .btn-submit {
            background: var(--light-access-bg);
            color: var(--light-text);
        }

        body.light-theme .button:hover,
        body.light-theme .btn-confirm:hover,
        body.light-theme .btn-exit:hover,
        body.light-theme .btn-submit:hover {
            background: var(--light-access-hover);
            color: #fff;
        }
    </style>
</head>

<body class="dark-theme">
    <div id="accessibility-screen">
        <div id="deleteChat">
            <h1 class="title">Delete chat</h1>
            <p class="material-symbols-outlined icon">error</p>
            <p class="description">Are you sure? This action can't be undone!</p>
            <div class="button-row">
                <div class="btn-confirm button" onclick="popupFunction.DeletePopup_clearChat()">Confirm</div>
                <div class="btn-exit button" onclick="popupFunction.disappear(document.getElementById('deleteChat'))">
                    Cancel</div>
            </div>
        </div>
        <div id="dataManager">
            <h1 class="title">Data Manager</h1>
            <div id="addData" style="display:flex;">
                <h2 id="section-title">Add data</h2>
                <label for="question-key">
                    Question:
                    <input type="text" name="question" id="question-key" autocomplete="off" autocorrect="off">
                </label>
                <label for="answer-key">
                    Answer:
                    <input type="text" name="answer" id="answer-key" autocomplete="off" autocorrect="off">
                </label>
                <div class="btn-submit button">Add data</div>
            </div>
            <div id="removeData" style="display:none;">

            </div>
            <div id="clearAllData" style="display:none;">

            </div>
            <p class="description">Drag this slider to control tab</p>
            <div class="button-row">
                <input type="range" min="1" max="3" id="rangeSliderData" onchange="">
                <div class="btn-exit button" onclick="popupFunction.disappear(document.getElementById('dataManager'))">
                    Exit</div>
            </div>
        </div>
    </div>
    <h1 id="chatbot-title">PHIXAH</h1>
    <div id="chat-container">
        <p id="chat-container-title">How can I help you today?</p>
    </div>
    <div class="input-group">
        <input type="text" id="user-input" placeholder="Enter your question or a math expression..." autocomplete="off"
            autocorrect="off">
        <div class="function">
            <div id="clear-button" class="accessibility"
                onclick="popupFunction.appear(document.getElementById('deleteChat'))" title="Clear chat history">
                <!-- SVG icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6" />
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                    <line x1="10" y1="11" x2="10" y2="17" />
                    <line x1="14" y1="11" x2="14" y2="17" />
                </svg>
            </div>
            <div id="switch-dark-light" class="accessibility" onclick="switchTheme()" title="Switch Dark/Light theme">
                <!-- SVG icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4" />
                </svg>
            </div>
            <div id="data-manager" class="accessibility"
                onclick="popupFunction.appear(document.getElementById('dataManager'))" title="Data Manager">
                <!-- SVG icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 11.08V8l-6-6H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h6" />
                    <path d="M14 3v5h5M18 21v-6M15 18h6" />
                </svg>
            </div>
        </div>
    </div>
    <script>
        // --- Variables --- //
        const chatContainer = document.getElementById("chat-container");
        const userInput = document.getElementById("user-input");

        const accessibilityScreen = document.getElementById('accessibility-screen');
        const deleteChatPopup = document.getElementById('deleteChat');

        // --- OOP: Chatbot System (TF-IDF + Cosine Similarity) --- //
        function ChatbotSystemNLP() {
            this.documents = [];
            this.responses = [];
            this.wordIDF = {};
        }
        ChatbotSystemNLP.prototype.checkIsMath = function (userInput) {
            var mathPattern = /\d+\s*[\+\-\*\/]\s*\d+([\s*[\+\-\*\/]\s*\d+]*)*|\(?\d+\.?\d*\)?[\s*[\+\-\*\/]\s*\(?\d+\.?\d*\)?]*/;
            return mathPattern.test(userInput);
        }
        ChatbotSystemNLP.prototype.solveMath = function (userInput) {
            var mathExpression = '';
            var match = null;

            match = userInput.match(/(\d+\s*[\+\-\*\/]\s*\d+([\s*[\+\-\*\/]\s*\d+]*)*)/);

            if (!match) {
                match = userInput.match(/[\d\s\+\-\*\/\(\)\.]+/);
            }

            if (match) {
                mathExpression = match[0].trim();
                mathExpression = mathExpression.replace(/[^\d\s\+\-\*\/\(\)\.]+$/, '').trim();

                if (userInput.indexOf("value of") !== -1) {
                    var parts = userInput.split("value of");
                    if (parts.length > 1) {
                        var potentialMath = parts[1].trim();
                        var matchAfterPhrase = potentialMath.match(/([\d\s\+\-\*\/\(\)\.]+)/);
                        if (matchAfterPhrase) {
                            mathExpression = matchAfterPhrase[0].trim().replace(/\?$/, ''); // Remove trailing '?'
                        } else {
                            mathExpression = ""; // No valid math after "value of"
                        }
                    }
                }

                if (mathExpression) {
                    try {
                        var result = eval(mathExpression);
                        var customOutput = {
                            0: "The value of " + mathExpression + " is " + result + ".",
                            1: "The answer to that math expression is " + result + ".",
                            2: "The result of that calculation is " + result + ".",
                            3: "Calculating " + mathExpression + " gives us " + result + ".",
                            4: "You asked for " + mathExpression + ", and the answer is " + result + ".",
                            5: "The solution to " + mathExpression + " is " + result + ".",
                        }
                        // Randomly select one of the custom output messages
                        const keys = Object.keys(customOutput);
                        const randomIndex = Math.floor(Math.random() * keys.length);
                        return customOutput[keys[randomIndex]];
                    } catch (e) {
                        return "Could not solve the expression '" + mathExpression + "': " + e.message;
                    }
                } else {
                    return "Could not find a clear mathematical expression in the string.";
                }
            } else {
                return "Could not find any potential mathematical expression in the string.";
            }
        }
        ChatbotSystemNLP.prototype.addData = function (question, response) {
            this.documents.push(question.toLowerCase());
            this.responses.push(response);
        }
        ChatbotSystemNLP.prototype.calculateTF = function (word, document) {
            const words = document.split(/\s+/);
            let count = 0;
            for (var w in words) if (words[w] === word) count++;
            return count / words.length;
        }
        ChatbotSystemNLP.prototype.calculateIDF = function (word) {
            if (this.wordIDF[word] !== undefined) return this.wordIDF[word];
            let count = 0;
            for (var i in this.documents) {
                var doc = this.documents[i];
                if (doc.split(/\s+/).indexOf(word) !== -1) count++;
            }
            const idf = Math.log(this.documents.length / (1 + count)) + 1;
            this.wordIDF[word] = idf;
            return idf;
        }
        ChatbotSystemNLP.prototype.computeVector = function (doc) {
            const words = doc.split(/\s+/);
            const tfidf = {};
            for (var i in words) {
                var word = words[i];
                if (!tfidf[word]) {
                    tfidf[word] = this.calculateTF(word, doc) * this.calculateIDF(word);
                }
            }
            return tfidf;
        }
        ChatbotSystemNLP.prototype.cosineSimilarity = function (v1, v2) {
            var sum = 0;
            var mag1 = 0;
            var mag2 = 0;
            var key;
            var keysObj = {};
            for (key in v1) { keysObj[key] = true; }
            for (key in v2) { keysObj[key] = true; }
            for (key in keysObj) {
                var a = v1[key] || 0;
                var b = v2[key] || 0;
                sum += a * b;
                mag1 += a * a;
                mag2 += b * b;
            }
            if (mag1 === 0 || mag2 === 0) return 0;
            return sum / (Math.sqrt(mag1) * Math.sqrt(mag2));
        }
        ChatbotSystemNLP.prototype.absoluteSame = function (userInput) {
            for (var i = 0; i < this.documents.length; i++) {
                if (userInput === this.documents[i].toLowerCase()) {
                    return this.responses[i];
                }
            }
        }
        ChatbotSystemNLP.prototype.findAnswer = function (userInput) {
            let answer = "Sorry, I can't understand";
            if (this.checkIsMath(userInput)) {
                answer = this.solveMath(userInput);
            }
            else if (this.absoluteSame(userInput)) {
                answer = this.absoluteSame(userInput);
            }
            else {
                const inputVector = this.computeVector(userInput.toLowerCase());
                let maxScore = 0;
                for (let i = 0; i < this.documents.length; i++) {
                    const docVector = this.computeVector(this.documents[i]);
                    const score = this.cosineSimilarity(inputVector, docVector);
                    if (score > maxScore) {
                        maxScore = score;
                        answer = this.responses[i];
                    }
                }
            }
            return answer;
        }

        // --- OOP: POPUP FUNCTION - Make for fast purpose --- //
        function PopupFunction() {
            // --- NOTHING here :)))) --- //
        }
        PopupFunction.prototype.appear = function (divElement) {
            var children = accessibilityScreen.children;
            for (var i = 0; i < children.length; i++) {
                children[i].style.display = 'none';
            }

            accessibilityScreen.style.display = 'flex';
            divElement.style.display = 'flex';

            void accessibilityScreen.offsetWidth;

            accessibilityScreen.style.animation = "popupBgFadeIn 0.5s ease";
            divElement.style.animation = "popupFadeIn 0.5s ease";
        }
        PopupFunction.prototype.disappear = function (divElement) {
            accessibilityScreen.style.animation = "popupBgFadeOut 0.5s ease";
            divElement.style.animation = "popupFadeOut 0.5s ease";
            setTimeout(function () {
                accessibilityScreen.style.display = 'none';
                accessibilityScreen.style.animation = '';
            }, 500);
            styleIfMessageNotExist();
        }
        PopupFunction.prototype.DeletePopup_clearChat = function () {
            chatContainer.querySelectorAll('*').forEach(function (n) {
                if (n.id !== 'chat-container-title') n.remove();
            });
            this.disappear(document.getElementById('deleteChat'));
        }


        var popupFunction = new PopupFunction();


        // --- Functions --- //
        function styleIfMessageNotExist() {
            document.getElementById('chat-container-title').style.display = 'block';
            chatContainer.style.alignItems = 'center';
            chatContainer.style.justifyContent = 'center';
        }
        function styleIfMessageExist() {
            document.getElementById('chat-container-title').style.display = 'none';
            chatContainer.style.alignItems = 'normal';
            chatContainer.style.justifyContent = 'normal';
        }

        function switchTheme() {
            if (document.body.classList.contains('light-theme')) {
                document.body.classList.remove('light-theme');
                document.body.classList.add('dark-theme');
                document.querySelectorAll('svg').forEach(function (i) {
                    i.setAttribute('stroke', 'white')
                });
            } else if (document.body.classList.contains('dark-theme')) {
                document.body.classList.remove('dark-theme');
                document.body.classList.add('light-theme');
                document.querySelectorAll('svg').forEach(function (i) {
                    i.setAttribute('stroke', 'black')
                });
            } else {
                document.body.classList.add('dark-theme');
            }
        }

        function clearChatBtn() {
            accessibilityScreen.style.display = 'flex';
            deleteChatPopup.style.display = 'flex';

            void accessibilityScreen.offsetWidth;

            accessibilityScreen.style.animation = "popupBgFadeIn 0.5s ease";
            deleteChatPopup.style.animation = "popupFadeIn 0.5s ease";
        }

        function removeHTML(str) {
            if (typeof str !== "string") str = String(str);
            return str
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function addMessage(message, isUser) {
            // Create message container and message elements
            const msgContainer = document.createElement("div");
            const msg = document.createElement("div");
            const msgIMG = document.createElement("img");

            msgContainer.style.display = 'flex';
            msgContainer.style.alignItems = 'center';

            // Escape HTML to prevent XSS
            const escaped = removeHTML(message);
            msgContainer.className = isUser ? "user-message" : "bot-message";
            msg.className = "message";
            msg.innerHTML = escaped;

            // Set avatar image based on user/bot
            msgIMG.setAttribute('src', isUser ? 'https://www.khanacademy.org/computer-programming/ka-img/5819110027018240/4850698350084096.png' : 'https://www.khanacademy.org/computer-programming/phixah-ico/6442661011963904/5033284292689920.png');
            msgIMG.setAttribute('loading', 'lazy');
            msgIMG.style.display = 'flex';
            msgIMG.style.justifyContent = 'center';

            msgIMG.style.width = '2em';
            msgIMG.style.height = '2em';

            // Order: user = [msg, img], bot = [img, msg]
            msgContainer.appendChild(isUser ? msg : msgIMG);
            msgContainer.appendChild(!isUser ? msg : msgIMG);

            chatContainer.appendChild(msgContainer);
            styleIfMessageExist();
        }
        function handleUserMessage() {
            // Get and trim user input
            const message = userInput.value.trim();
            if (message) {
                addMessage(message, true);

                // Show loading animation for bot response
                const loadingMsg = document.createElement("div");
                loadingMsg.className = "bot-message loading";
                loadingMsg.innerHTML = '<div class="dot-typing"><div></div><div></div><div></div>';

                chatContainer.appendChild(loadingMsg);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                userInput.value = "";
                setTimeout(function () {
                    // Find and display bot response after delay
                    const response = chatbot.findAnswer(message);
                    chatContainer.removeChild(loadingMsg);
                    addMessage(response, false);
                }, 2000);
            }
        }

        // --- DATA --- //
        const chatbot = new ChatbotSystemNLP();

        // Example data for chatbot to match against
        const dataTesting = {
            "Hello!": "Hello, how can I assist you today?",
            "Hi!": "Hi! How are you?",
            "Hi": "Hi! How can i help you today?",
            "Hello": "Hello! What do you need me to help?",
            "What is Python?": "Python is a high level programming language which is begginer-friendly"
        };

        // Add each question/response pair to the chatbot
        for (var question in dataTesting) {
            chatbot.addData(question, dataTesting[question]);
        }
        styleIfMessageNotExist();



        // --- Event Listeners --- //
        userInput.addEventListener("keydown", function (e) {
            // Only allow if there is no loading message
            if (!document.querySelector('.loading')) {
                if (e.key === "Enter" && !e.shiftKey) {
                    e.preventDefault();
                    handleUserMessage();
                }
            }
        });

    </script>

    <!--The Thumbnail Script 2.1.0 12/18/2023 by Bluebird@kaid_157624541333313939750668-->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script><script type>var r=600,s=document.documentElement.clientWidth;window.parent.html2canvas=t=>{try{html2canvas(document.body,{width:s,height:s,useCORS:!0,onclone:t=>t.getAnimations().forEach((t=>{try{t.finish()}catch{}}))}).then((t=>{var e=document.createElement("canvas");e.width=r,e.height=r,e.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,r,r),window.top.postMessage(e.toDataURL(),"*")})).catch((t=>{alert("Thumbnail Script Error: "+t)}))}catch{window.top.postMessage(document.createElement("canvas").toDataURL(),"*")}};</script>
</body>

</html>