<!DOCTYPE html>
<!--
					Contest: AI
				
		 I have completed 100% of Khan Academy's 
		'Intro to HTML/CSS' and have been programming 
					for 17 months.
	
		  I would prefer to be placed in the
					[Intermediate]
					   bracket
					   
		In creating this entry, I focused on make an AI chatbot that can answer every user's questions about Python programming.
								
  One aspect I found challenging was to make the chatbot can understand the user question in case right syntax or wrong syntax, also the .md format for the chatbot content.
								
				   I would like to highlight
		This chatbot use a TF-IDF and Consine Similarity to
		understand the user question if it is not at true
		grammer or it's at the same meaning but different way 
		to express, so it's use for the check the best match.
		In this challenge, I learned about how to use make
		user can copy everything in a big code blocks without
		externals API, Markdown syntax for the chatbot, and 
		advanced styling.
						for the judges.
					   
	
	TODO:
	 - Fill out statements above (Done)
	 - Save your entry as a spin-off of this program (Done)
	 - Have fun! (Not yet :))
-->
<!--
	This chatbot still don't have enough, I only add one data for it to answer only one question: What is Python?
	Sorry for inconvenience, i will add more data, and allow user to train it also in a user-friendly way, not to change the code!.
-->
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>PhixahAI (demo)</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
		rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap" rel="stylesheet">
	<style>
		* {
			transition: all 0.5s ease;
			box-sizing: border-box;
		}

		body {
			margin: 0;
			padding: 20px;
			background-color: #1b1b1b;
			font-family: 'Montserrat', sans-serif;
			color: white;
		}

		body::-webkit-scrollbar {
			display: none;
		}

		#chat-container {
			height: 27.7em;
			overflow-y: auto;
			padding: 10px;
			display: flex;
			flex-direction: column;
			gap: 10px;
			border: 1px solid #333;
			border-radius: 8px;
			background-color: #121212;
		}

		#chat-container::-webkit-scrollbar {
			display: none;
		}

		.user-message,
		.bot-message {
			padding: 10px 20px;
			border-radius: 10px;
			word-wrap: break-word;
			white-space: pre-wrap;
			overflow-wrap: break-word;
			font-family: 'Segoe UI', Ubuntu, sans-serif;
		}

		.user-message {
			align-self: flex-end;
			background-color: #292929;
			text-align: right;
			max-width: 70%;
		}

		.bot-message {
			align-self: flex-start;
			text-align: left;
			line-height: 1.5em;
		}

		.input-group {
			margin-top: 10px;
			display: flex;
			gap: 0.5em;
			background-color: #292929;
		}

		#user-input {
			padding: 1.25em 1em;
			border: none;
			border-radius: 0.25em;
			font-family: 'Montserrat', sans-serif;
			font-size: 1em;
			background-color: #292929;
			color: white;
			resize: none;
			height: 2em;
			width: 100%;
			line-height: 1.4em;
			overflow: auto;
		}

		#user-input::placeholder {
			color: rgb(160, 160, 160);
		}

		#user-input:focus {
			outline: none;
		}

		#user-input::-webkit-scrollbar {
			display: none;
		}

		.function {
			display: flex;
			justify-content: flex-end;
			align-items: center;
			padding-right: 0.5em;
		}

		#clear-button {
			background-color: #292929;
			padding: 0.4em;
		}

		#clear-button:hover {
			background-color: #414141;
		}

		#chatbot-title {
			font-family: 'Montserrat', sans-serif;
			font-weight: 700;
			font-size: 3em;
			color: white;
			text-align: center;
			margin: 0 0 10px;
		}

		#chat-container-title {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			font-size: 1.5em;
			color: white;
			text-align: center;
		}

		.dot-typing {
			display: inline-block;
			position: relative;
			width: 24px;
			height: 8px;
		}

		.dot-typing div {
			position: absolute;
			width: 5px;
			height: 5px;
			background-color: #ccc;
			border-radius: 50%;
			animation: dotTypingAnim 1s infinite ease-in-out;
		}

		.dot-typing div:nth-child(1) {
			left: 0;
			animation-delay: 0s;
		}

		.dot-typing div:nth-child(2) {
			left: 8px;
			animation-delay: 0.2s;
		}

		.dot-typing div:nth-child(3) {
			left: 16px;
			animation-delay: 0.4s;
		}

		@keyframes dotTypingAnim {

			0%,
			80%,
			100% {
				transform: scale(0.8);
				opacity: 0.5;
			}

			40% {
				transform: scale(1.2);
				opacity: 1;
			}
		}
	</style>
</head>

<body>
	<h1 id="chatbot-title">PHIXAH</h1>
	<div id="chat-container">
		<p id="chat-container-title">How can i help you today?</p>
	</div>
	<div class="input-group">
		<input type="text" id="user-input" placeholder="Enter your question...">
		<div class="function">
			<div id="clear-button" onclick="clearChat()" title="Clear chat history">
				<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
					stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<polyline points="3 6 5 6 21 6"></polyline>
					<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
					<line x1="10" y1="11" x2="10" y2="17"></line>
					<line x1="14" y1="11" x2="14" y2="17"></line>
				</svg>
			</div>
		</div>
	</div>

	<script>
		// Get HTML Elements
		var copyButton = document.getElementsByClassName("copy-button");
		var chatContainer = document.getElementById("chat-container");
		var userInput = document.getElementById("user-input");

		// Styling by condition
		function styleIfMessageNotExist() {
			document.getElementById('chat-container-title').style.display = 'block';
			chatContainer.style.alignItems = 'center';
			chatContainer.style.justifyContent = 'center';
		}
		function styleIfMessageExist() {
			document.getElementById('chat-container-title').style.display = 'none';
			chatContainer.style.alignItems = 'normal';
			chatContainer.style.justifyContent = 'normal';
		}

		// The TF-IDF LLMS module
		function manageChatbotSystem() {
			this.documents = [];
			this.responses = [];
			this.wordIDF = {};
		}
		manageChatbotSystem.prototype.addData = function (question, response) {
			this.documents.push(question.toLowerCase());
			this.responses.push(response);
		}
		manageChatbotSystem.prototype.calculateTF = function (word, document) {
			var words = document.split(/\s+/);
			var count = 0;
			for (var i = 0; i < words.length; i++) {
				if (words[i] === word) count++;
			}
			return count / words.length;
		}
		manageChatbotSystem.prototype.calculateIDF = function (word) {
			if (this.wordIDF[word] !== undefined) return this.wordIDF[word];
			var count = 0;
			for (var i = 0; i < this.documents.length; i++) {
				if (this.documents[i].split(/\s+/).indexOf(word) !== -1) count++;
			}
			var idf = Math.log(this.documents.length / (1 + count)) + 1;
			this.wordIDF[word] = idf;
			return idf;
		}
		manageChatbotSystem.prototype.computeVector = function (doc) {
			var words = doc.split(/\s+/);
			var tfidf = {};
			for (var i = 0; i < words.length; i++) {
				var word = words[i];
				if (!tfidf[word]) {
					tfidf[word] = this.calculateTF(word, doc) * this.calculateIDF(word);
				}
			}
			return tfidf;
		}
		manageChatbotSystem.prototype.cosineSimilarity = function (v1, v2) {
			var sum = 0, mag1 = 0, mag2 = 0;
			var keys = {};
			for (var key in v1) keys[key] = true;
			for (var key in v2) keys[key] = true;
			for (var key in keys) {
				var a = v1[key] || 0;
				var b = v2[key] || 0;
				sum += a * b;
				mag1 += a * a;
				mag2 += b * b;
			}
			if (mag1 === 0 || mag2 === 0) return 0;
			return sum / (Math.sqrt(mag1) * Math.sqrt(mag2));
		}
		manageChatbotSystem.prototype.findAnswer = function (userInput) {
			var inputVector = this.computeVector(userInput.toLowerCase());
			var maxScore = 0;
			var answer = "Sorry, I can't understand";
			for (var i = 0; i < this.documents.length; i++) {
				var docVector = this.computeVector(this.documents[i]);
				var score = this.cosineSimilarity(inputVector, docVector);
				if (score > maxScore) {
					maxScore = score;
					answer = this.responses[i];
				}
			}
			return answer;
		}

		// Create chatbot object and add data into it, also style the title inside the chat container
		var chatbot = new manageChatbotSystem();
		var dataTesting = {
			"nothing": "ok, it's nothing"
		};
		var greetingInput = {
			greetingSimple: ["Hi", "Hi!", "Hello", "Hello!"],
			advancedGreeting: {
				"Good morning!": "Good morning! Have a nice day!",
				"Good afternoon!": "Good afternoon! How can i help you today?",
				"Good night!": "Sweet dream, if you have any question about python, feel free to ask!",
				"Good morning": "Good morning! Have a nice day!",
				"Good afternoon": "Good afternoon! How can i help you today?",
				"Good night": "Sweet dream, if you have any question about python, feel free to ask!"
			}
		};

		for (var question in dataTesting) {
			chatbot.addData(question, dataTesting[question]);
		}
		greetingInput.greetingSimple.forEach(function (q) {
			chatbot.addData(q, "Hello!, how can i assist you today?");
		})
		for (var greeting in greetingInput.advancedGreeting) {
			chatbot.addData(greeting, greetingInput.advancedGreeting[greeting]);
		}

		styleIfMessageNotExist();

		// Loading function
		function loading() {
			this.loadingMessage = document.getElementById("loading-message");
		}
		loading.prototype.show = function () {
			this.loadingMessage.style.display = "block";
			chatContainer.scrollTop = chatContainer.scrollHeight;
		}
		loading.prototype.hide = function () {
			this.loadingMessage.style.display = "none";
		}

		// Message
		function addMessage(message, isUser) {
			var msg = document.createElement("div");
			msg.className = isUser ? "user-message" : "bot-message";
			msg.innerHTML = message;
			chatContainer.appendChild(msg);
			chatContainer.scrollTop = chatContainer.scrollHeight;
			styleIfMessageExist();
		}
		function handleUserMessage() {
			var message = userInput.value.trim();
			if (message) {
				addMessage(message, true);

				const loadingMsg = document.createElement("div");
				loadingMsg.className = "bot-message loading";
				loadingMsg.innerHTML = '<div class="dot-typing"><div></div><div></div><div></div></div>';
				chatContainer.appendChild(loadingMsg);
				chatContainer.scrollTop = chatContainer.scrollHeight;

				userInput.value = "";

				setTimeout(function () {
					var response = chatbot.findAnswer(message);
					chatContainer.removeChild(loadingMsg);
					addMessage(response, false);
				}, 2000)
			}
		}

		// Handle onclick event
		//// Clear chat event
		function clearChat() {
			chatContainer.querySelectorAll('*').forEach(function (n) {
				if (n.id !== 'chat-container-title') {
					n.remove();
				}
			});
			styleIfMessageNotExist();
			alert("Chat cleared successfully");
		}

		userInput.addEventListener("keydown", function (e) {
			if (e.key === "Enter" && !e.shiftKey) {
				e.preventDefault();
				handleUserMessage();
			}
		})
	</script>
</body>

</html>